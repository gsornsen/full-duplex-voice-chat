# Codecov Configuration
# https://docs.codecov.com/docs/codecov-yaml

# Coverage targets and behavior
coverage:
  precision: 2  # 2 decimal places for coverage percentages
  round: down  # Round down to nearest integer
  range: "60...90"  # Green at 90%, red at 60%

  status:
    # Overall project coverage
    project:
      default:
        target: 80%  # Minimum 80% overall coverage
        threshold: 2%  # Allow 2% drop before failing
        base: auto  # Compare to base branch automatically
        if_ci_failed: error  # Fail if CI fails

    # Coverage for changed code in PR
    patch:
      default:
        target: 60%  # Minimum 60% coverage for new code
        threshold: 5%  # Allow 5% variance
        base: auto
        if_ci_failed: error

  # Ignore specific files/directories
  ignore:
    - "src/rpc/generated/**"  # Auto-generated protobuf stubs
    - "tests/**"  # Test files themselves
    - "setup.py"
    - "**/__init__.py"  # Package init files
    - "src/client/web/**"  # Frontend code (separate coverage)

# GitHub PR comments
comment:
  layout: "reach,diff,flags,files,footer"
  behavior: default
  require_changes: false  # Always comment, even if no changes
  require_base: false  # Comment even if base coverage not available
  require_head: true  # Require head coverage to comment

# Flags for organizing coverage by test type
flags:
  unittests:
    paths:
      - src/
    carryforward: false  # Don't carry forward from previous commits

# Disable GitHub Checks integration (using status API instead)
github_checks:
  annotations: true  # Show annotations on code

# PR comment format
comment:
  layout: "header,diff,flags,files,footer"
  hide_comment_details: false

# Notification settings
slack:
  enabled: false  # Disable Slack notifications (configure if needed)

# CI providers
codecov:
  require_ci_to_pass: true
  notify:
    wait_for_ci: true
